CREATE TABLE t1 (c0 INTEGER PRIMARY KEY, c1 TEXT); CREATE TABLE t0 (c0 INTEGER PRIMARY KEY, c1 TEXT, c2 DOUBLE, c3 TEXT GENERATED ALWAYS AS (CASE WHEN c2 > 120 THEN 'High' ELSE 'Low' END) STORED, FOREIGN KEY (c0) REFERENCES t1(c0)); INSERT INTO t1 (c0, c1) VALUES (1, 'Department A'), (2, 'Department B'), (3, 'Department C'); INSERT INTO t0 (c0, c1, c2) VALUES (1, 'Alice', 120.5), (2, 'Bob', 150.0), (3, 'Charlie', 110.75); WITH processed_data AS (SELECT t0.c0, t0.c1, t0.c2, t0.c3, ROW_NUMBER() OVER (ORDER BY t0.c2 DESC) AS rank_desc, RANK() OVER (PARTITION BY t0.c3 ORDER BY t0.c2 DESC) AS category_rank FROM t0 JOIN t1 ON t0.c0 = t1.c0) SELECT c0, c1, c2 AS score, c3 AS performance_level, category_rank FROM processed_data WHERE category_rank <= 2 ORDER BY rank_desc;