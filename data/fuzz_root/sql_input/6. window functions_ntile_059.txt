CREATE TABLE t0(c0 INTEGER, c1 DOUBLE, c2 TEXT); INSERT INTO t0 VALUES (10, 0.98765, 'v0_repeat'), (20, -0.87654, 'v1_diff'), (30, 0.76543, 'v2_diff_neg'), (40, -0.65432, 'v3_repeat_neg'), (50, 0.54321, 'v4_end'); SELECT c0, c1, NTILE(4) OVER (PARTITION BY MOD(c0, 5) ORDER BY SIGN(c1) * LENGTH(c2)) AS ntile_rank FROM t0;