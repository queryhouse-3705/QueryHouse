CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 TEXT, c3 DOUBLE, c4 FLOAT); INSERT INTO t0(c0, c1, c2, c3, c4) VALUES (1, -0.1, 'a', 2.2, 1.1), (2, 0.2, 'b', -3.3, 2.2), (3, -0.3, 'c', 4.4, -1.1), (4, 0.4, 'd', -5.5, 3.3), (5, -0.5, 'a', 6.6, -2.2); SELECT c0, c1, c2, c3, c4, PERCENT_RANK() OVER (PARTITION BY c2 ORDER BY ABS(c3 + c4) * c1 DESC) AS rank_percent FROM t0;