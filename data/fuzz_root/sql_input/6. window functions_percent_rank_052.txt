CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 DOUBLE, c3 TEXT, c4 FLOAT); INSERT INTO t0(c0, c1, c2, c3, c4) VALUES (1, -0.01, 10.5, 'v0', -1.1), (2, 0.02, -20.6, 'v1', 1.2), (3, -0.03, 30.7, 'v2', -1.3), (4, 0.04, -40.8, 'v3', 1.4), (5, -0.05, 50.9, 'v4', -1.5); SELECT c0, c1, c2, c3, c4, PERCENT_RANK() OVER (PARTITION BY c3 LIKE 'v%' ORDER BY SIGN(c1) * ABS(c2 + c4) DESC) AS rank_percent FROM t0;