CREATE TABLE t0(c0 INTEGER, c1 FLOAT); INSERT INTO t0(c0, c1) VALUES (1, 50.0), (2, 50.0), (3, 100.0), (4, -50.0), (5, 0.0); SELECT c0, c1, PERCENT_RANK() OVER (PARTITION BY c1 / NULLIF(c0, 0) ORDER BY c1 DESC NULLS LAST) AS rank_percent FROM t0;