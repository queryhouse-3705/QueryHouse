CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 TEXT); CREATE TABLE t1(c0 INTEGER, c1 FLOAT); INSERT INTO t0 VALUES (1, 1.23, 'v0_alpha'), (2, -2.34, 'v1_beta'), (3, 3.45, 'v2_gamma'), (4, -4.56, 'v3_delta'), (5, 0.0, 'v4_epsilon'); INSERT INTO t1 VALUES (1, 100.1), (2, -200.2), (3, 300.3), (4, -400.4), (5, 500.5); SELECT t0.c0, t1.c1, NTILE(3) OVER (PARTITION BY SIGN(t1.c1) ORDER BY POWER(t0.c1, 2) + LENGTH(t0.c2)) AS ntile_rank FROM t0 INNER JOIN t1 ON t0.c0 = t1.c0;