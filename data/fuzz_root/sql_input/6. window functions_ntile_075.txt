CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 TEXT); CREATE TABLE t1(c0 INTEGER, c1 DOUBLE, c2 TEXT); INSERT INTO t0 VALUES (1, 123.456, 'v0_high'), (2, -123.456, 'v1_low'), (3, 0.001, 'v2_small'), (4, -0.001, 'v3_tiny'), (5, 0.0, 'v4_zero'); INSERT INTO t1 VALUES (1, 3.14159, 'v1_pi'), (2, -3.14159, 'v2_neg_pi'), (3, 2.71828, 'v3_e'), (4, -2.71828, 'v4_neg_e'), (5, 0.0, 'v5_origin'); SELECT t0.c0, t1.c2, NTILE(4) OVER (PARTITION BY MOD(t0.c0, 2) ORDER BY CEIL(t1.c1) + LENGTH(t0.c2)) AS ntile_rank FROM t0 LEFT JOIN t1 ON t0.c0 = t1.c0;