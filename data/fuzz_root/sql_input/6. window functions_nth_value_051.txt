CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(10), c3 DOUBLE); INSERT INTO t0 (c0, c1, c2, c3) VALUES (10, 1.0, 'group1', -11.1), (20, -2.0, 'group2', 22.2), (30, 3.0, 'group1', -33.3), (40, -4.0, 'group3', 44.4), (50, 5.0, 'group2', -55.5); SELECT nth_value(c3, 3) OVER (PARTITION BY c2 ORDER BY c0 RANGE BETWEEN UNBOUNDED PRECEDING AND 2 FOLLOWING) - nth_value(c1, 1) OVER (PARTITION BY c2 ORDER BY c0 DESC) AS adjusted_sum FROM t0;