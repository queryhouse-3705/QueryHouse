CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(5), c3 DOUBLE); INSERT INTO t0 (c0, c1, c2, c3) VALUES (10, 1.0, 'alpha', -0.5), (20, -2.0, 'beta', 1.5), (30, 3.0, 'alpha', -2.5), (40, -4.0, 'gamma', 3.5), (50, 5.0, 'beta', -4.5); SELECT nth_value(c1 + c3, 3) OVER (PARTITION BY c2 ORDER BY c0 DESC RANGE BETWEEN 1 PRECEDING AND CURRENT ROW) - nth_value(c3, 2) OVER (PARTITION BY c2 ORDER BY c0) AS adjusted_difference FROM t0;