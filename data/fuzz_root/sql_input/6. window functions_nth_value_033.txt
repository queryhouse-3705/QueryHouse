CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(5), c3 DOUBLE); INSERT INTO t0 (c0, c1, c2, c3) VALUES (11, 123.45, 'alpha', 100.01), (12, -234.56, 'beta', -200.02), (13, 345.67, 'alpha', 300.03), (14, -456.78, 'gamma', -400.04), (15, 567.89, 'beta', 500.05); SELECT nth_value(c1 / c3, 1) OVER (PARTITION BY c2 ORDER BY c0 RANGE BETWEEN 1 PRECEDING AND UNBOUNDED FOLLOWING) - nth_value(c3, 2) OVER (PARTITION BY c2 ORDER BY c0 DESC) AS adjusted FROM t0;