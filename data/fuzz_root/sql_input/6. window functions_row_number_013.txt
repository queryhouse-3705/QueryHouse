CREATE TABLE t0 (c0 TEXT, c1 FLOAT, c2 TEXT); INSERT INTO t0 (c0, c1, c2) VALUES ('v0', 1.1, 'group1'), ('v1', 2.2, 'group2'), ('v2', 3.3, 'group1'), ('v3', 4.4, 'group2'); SELECT c0, c1, c2, ROW_NUMBER() OVER (PARTITION BY c2 ORDER BY c1 DESC, LENGTH(c0)) AS rn FROM t0;