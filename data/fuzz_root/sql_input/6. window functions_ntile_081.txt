CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 TEXT); CREATE TABLE t1(c0 INTEGER, c1 FLOAT); INSERT INTO t0 VALUES (10, -0.01, 'v0_negative'), (20, 0.02, 'v1_positive'), (30, -0.03, 'v2_neg_tiny'), (40, 0.04, 'v3_pos_tiny'), (50, 0.0, 'v4_zero'); INSERT INTO t1 VALUES (10, 0.001), (20, -0.002), (30, 0.003), (40, -0.004), (50, 0.005); SELECT t0.c0, t1.c1, NTILE(3) OVER (PARTITION BY LENGTH(t0.c2) ORDER BY ABS(t1.c1)) AS ntile_rank FROM t0 INNER JOIN t1 ON t0.c0 = t1.c0;