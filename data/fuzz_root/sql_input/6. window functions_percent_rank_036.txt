CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 TEXT, c3 DOUBLE, c4 INTEGER); INSERT INTO t0(c0, c1, c2, c3, c4) VALUES (1, 0.01, 'alpha', 1.1, 10), (2, -0.02, 'beta', -2.2, 20), (3, 0.03, 'gamma', 3.3, 30), (4, -0.04, 'alpha', -4.4, 10), (5, 0.05, 'delta', 5.5, 20); SELECT c0, c1, c2, c3, c4, PERCENT_RANK() OVER (PARTITION BY c2 ORDER BY CASE WHEN c4 > 15 THEN ABS(c1) * c3 ELSE c1 + c3 END DESC) AS rank_percent FROM t0;