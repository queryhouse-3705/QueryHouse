CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(5), c3 DOUBLE); INSERT INTO t0 (c0, c1, c2, c3) VALUES (10, -1.0, 'alpha', 100.1), (20, 2.0, 'beta', -200.2), (30, -3.0, 'alpha', 300.3), (40, 4.0, 'gamma', -400.4), (50, -5.0, 'beta', 500.5); SELECT nth_value(c3 / c1, 2) OVER (PARTITION BY c2 ORDER BY c0 DESC ROWS BETWEEN 1 PRECEDING AND CURRENT ROW) - nth_value(c3, 1) OVER (PARTITION BY c2 ORDER BY c0 ASC) AS difference FROM t0;