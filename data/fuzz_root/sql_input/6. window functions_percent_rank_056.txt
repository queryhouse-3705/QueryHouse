CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 TEXT, c3 FLOAT, c4 DOUBLE); INSERT INTO t0(c0, c1, c2, c3, c4) VALUES (1, 3.141, 'pi', 2.718, -1.618), (2, -2.718, 'e', -3.141, 1.414), (3, 1.618, 'phi', 0.577, -0.577), (4, -1.414, 'sqrt', 3.141, 2.718), (5, 0.577, 'log', -2.718, -3.141); SELECT c0, c1, c2, c3, c4, PERCENT_RANK() OVER (PARTITION BY c4 < 0 ORDER BY CASE WHEN c2 LIKE 'pi%' THEN c3 + c4 ELSE ABS(c1 - c3) END ASC) AS rank_percent FROM t0;