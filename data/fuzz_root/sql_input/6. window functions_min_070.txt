CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 DOUBLE); INSERT INTO t0 VALUES (1, 10.1, -100.01), (2, -20.2, 200.02), (3, 30.3, -300.03), (4, -40.4, 400.04); SELECT MIN(c1 / c0 + c2) OVER (PARTITION BY c2 < 0 ORDER BY c1 DESC ROWS BETWEEN 1 PRECEDING AND 2 FOLLOWING) AS min_weighted_ratio FROM t0;