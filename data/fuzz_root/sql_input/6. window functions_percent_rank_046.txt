CREATE TABLE t0(c0 INTEGER, c1 DOUBLE, c2 FLOAT, c3 TEXT, c4 FLOAT); INSERT INTO t0(c0, c1, c2, c3, c4) VALUES (1, 10.1, 0.1, 'alpha', -1.1), (2, -20.2, -0.2, 'beta', 2.2), (3, 30.3, 0.3, 'gamma', -3.3), (4, -40.4, -0.4, 'delta', 4.4), (5, 50.5, 0.5, 'epsilon', -5.5); SELECT c0, c1, c2, c3, c4, PERCENT_RANK() OVER (PARTITION BY LENGTH(c3) ORDER BY CASE WHEN c4 < 0 THEN c1 + c2 ELSE c1 * c2 END) AS rank_percent FROM t0;