CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(10), c3 INTEGER); INSERT INTO t0 (c0, c1, c2, c3) VALUES (1, 100.0, 'A', 1), (2, -200.0, 'B', 2), (3, 300.0, 'A', 3), (4, -400.0, 'C', 4), (5, 500.0, 'B', 5); SELECT c0, c1, c2, c3, LAST_VALUE(SUM(c1 * c3) OVER (PARTITION BY c2 ORDER BY c3 DESC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)) OVER (PARTITION BY CASE WHEN c3 % 2 = 0 THEN 'Even' ELSE 'Odd' END ORDER BY c1 ASC ROWS BETWEEN 1 FOLLOWING AND 2 FOLLOWING) AS last_value_partition_compare FROM t0;