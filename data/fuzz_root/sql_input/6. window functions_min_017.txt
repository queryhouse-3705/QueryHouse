CREATE TABLE t0 (c0 DOUBLE, c1 JSON, c2 FLOAT, c3 TEXT, c4 VARCHAR(50)); INSERT INTO t0 VALUES (-100.1, '{"key1": "value1"}', 10.1, 'v0', 'v1'), (200.2, '{"key2": 123}', -20.2, 'v2', 'v3'), (-300.3, '{"array": [1,2,3]}', 30.3, 'v4', 'v5'), (400.4, '{"nested": {"key3": "value3"}}', -40.4, 'v6', 'v7'); SELECT c0, c1, MIN(CASE WHEN LENGTH(c3) > 2 THEN c0 * c2 ELSE c0 / c2 END) OVER (PARTITION BY c4 ORDER BY c2 DESC ROWS BETWEEN 1 FOLLOWING AND UNBOUNDED FOLLOWING) AS min_complex FROM t0;