CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(10), c3 DOUBLE); INSERT INTO t0 (c0, c1, c2, c3) VALUES (10, 0.1, 'cluster1', -10.1), (20, -0.2, 'cluster2', 20.2), (30, 0.3, 'cluster1', -30.3), (40, -0.4, 'cluster3', 40.4), (50, 0.5, 'cluster2', -50.5); SELECT nth_value(c1 + c3, 3) OVER (PARTITION BY c2 ORDER BY c0 DESC ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) + nth_value(c1, 2) OVER (PARTITION BY c2 ORDER BY c0 ASC) AS cumulative_metric FROM t0;