CREATE TABLE t0 (c0 DOUBLE, c1 INTEGER, c2 TEXT); INSERT INTO t0 (c0, c1, c2) VALUES (0.1, 1, 'x'), (0.2, 2, 'y'), (0.3, 3, 'x'), (0.4, 4, 'z'); SELECT c0, c1, c2, ROW_NUMBER() OVER (PARTITION BY c2 ORDER BY c1 * c0 ASC, c1 DESC) AS rn FROM t0;