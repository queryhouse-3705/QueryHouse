CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(10)); INSERT INTO t0 (c0, c1, c2) VALUES (1, -999.9, 'grp1'), (2, -888.8, 'grp2'), (3, -777.7, 'grp1'), (4, -666.6, 'grp3'), (5, -555.5, 'grp2'); SELECT nth_value(c1, 1) OVER (PARTITION BY c2 ORDER BY c0 DESC ROWS BETWEEN CURRENT ROW AND 1 FOLLOWING) / nth_value(c1, 3) OVER (PARTITION BY c2 ORDER BY c0 ASC) AS ratio FROM t0;