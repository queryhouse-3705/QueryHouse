CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(5), c3 DOUBLE); INSERT INTO t0 (c0, c1, c2, c3) VALUES (1, -1.23, 'a', 10.0), (2, 0.0, 'b', -20.5), (3, 3.14, 'a', 30.1), (4, -2.71, 'c', -40.2), (5, 4.56, 'b', 50.3); SELECT nth_value(c1 * c3, 1) OVER (PARTITION BY c2 ORDER BY c0 RANGE BETWEEN 2 PRECEDING AND 2 FOLLOWING) - nth_value(c3, 2) OVER (PARTITION BY c2 ORDER BY c0 DESC) AS combined_result FROM t0;