CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 DOUBLE, c3 TEXT, c4 DOUBLE); INSERT INTO t0(c0, c1, c2, c3, c4) VALUES (1, -1.1, 0.1, 'x', -10.5), (2, 2.2, -0.2, 'y', 20.6), (3, -3.3, 0.3, 'z', -30.7), (4, 4.4, -0.4, 'x', 40.8), (5, -5.5, 0.5, 'y', -50.9); SELECT c0, c1, c2, c3, c4, PERCENT_RANK() OVER (PARTITION BY c3 ORDER BY CASE WHEN c4 < 0 THEN c1 + c2 ELSE c1 * c2 END ASC) AS rank_percent FROM t0;