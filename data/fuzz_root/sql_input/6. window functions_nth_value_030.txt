CREATE TABLE t0 (c0 INTEGER, c1 DOUBLE, c2 FLOAT, c3 VARCHAR(10)); INSERT INTO t0 (c0, c1, c2, c3) VALUES (5, 1234.567, 0.01, 'group1'), (15, 2345.678, -0.02, 'group2'), (25, -3456.789, 0.03, 'group1'), (35, 4567.890, -0.04, 'group3'), (45, -5678.901, 0.05, 'group2'); SELECT nth_value(c1 / c2, 3) OVER (PARTITION BY c3 ORDER BY c0 DESC ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) AS ratio FROM t0 WHERE c2 <> 0.0;