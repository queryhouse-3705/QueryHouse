CREATE TABLE t0(c0 INTEGER, c1 DOUBLE, c2 FLOAT, c3 TEXT, c4 INTEGER); INSERT INTO t0(c0, c1, c2, c3, c4) VALUES (1, 100.1, -0.1, 'v0', 10), (2, -200.2, 0.2, 'v1', 20), (3, 300.3, -0.3, 'v2', 30), (4, -400.4, 0.4, 'v3', 10), (5, 500.5, -0.5, 'v4', 20); SELECT c0, c1, c2, c3, c4, PERCENT_RANK() OVER (PARTITION BY c3 ORDER BY ABS(c1 / NULLIF(c4, 0)) + c2 * c4 ASC) AS rank_percent FROM t0;