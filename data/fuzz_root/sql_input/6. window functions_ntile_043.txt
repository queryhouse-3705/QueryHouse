CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 TEXT); INSERT INTO t0 VALUES (-10, 100.1, 'v0'), (10, -100.1, 'v1'), (20, 200.2, 'v2'), (-20, -200.2, 'v3'), (30, 300.3, 'v4'); SELECT c0, c1, NTILE(4) OVER (PARTITION BY SIGN(c1) ORDER BY FLOOR(c1 / 10) DESC, LENGTH(c2)) AS ntile_rank FROM t0;