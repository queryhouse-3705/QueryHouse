CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(10), c3 FLOAT); INSERT INTO t0 (c0, c1, c2, c3) VALUES (1, 10.01, 'v0', 100.1), (2, 20.02, 'v1', 200.2), (3, 30.03, 'v0', 300.3), (4, 40.04, 'v2', 400.4), (5, 50.05, 'v1', 500.5); SELECT nth_value(c3, 3) OVER (PARTITION BY c2 ORDER BY c1 DESC ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING) - nth_value(c1, 1) OVER (ORDER BY c0) AS result FROM t0;