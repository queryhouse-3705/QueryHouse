CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 TEXT, c3 FLOAT, c4 DOUBLE); INSERT INTO t0(c0, c1, c2, c3, c4) VALUES (1, 0.1, 'x', -0.1, 1.1), (2, -0.2, 'y', 0.2, -2.2), (3, 0.3, 'z', -0.3, 3.3), (4, -0.4, 'x', 0.4, -4.4), (5, 0.5, 'y', -0.5, 5.5); SELECT c0, c1, c2, c3, c4, PERCENT_RANK() OVER (PARTITION BY c2 ORDER BY CASE WHEN c4 < 0 THEN c1 + c3 ELSE ABS(c1 * c3) END) AS rank_percent FROM t0;