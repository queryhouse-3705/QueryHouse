CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 DOUBLE, c3 TEXT, c4 INTEGER); INSERT INTO t0(c0, c1, c2, c3, c4) VALUES (1, 1.1, -2.2, 'alpha', 10), (2, -3.3, 4.4, 'beta', 20), (3, 5.5, -6.6, 'gamma', 30), (4, 7.7, 8.8, 'delta', 10), (5, -9.9, 0.0, 'epsilon', 20); SELECT c0, c1, c2, c3, c4, PERCENT_RANK() OVER (PARTITION BY c3 ORDER BY (c1 * c2) / NULLIF(c4, 0) ASC NULLS LAST) AS rank_percent FROM t0;