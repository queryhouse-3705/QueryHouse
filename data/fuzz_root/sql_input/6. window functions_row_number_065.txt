CREATE TABLE t0 (c0 FLOAT, c1 DOUBLE, c2 TEXT); INSERT INTO t0 (c0, c1, c2) VALUES (1.5, 0.001, 'level1'), (2.5, 0.002, 'level2'), (3.5, 0.003, 'level1'), (4.5, 0.004, 'level3'); SELECT c0, c1, c2, ROW_NUMBER() OVER (PARTITION BY c2 ORDER BY c1 * c0 ASC, c2) AS rn FROM t0;