CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 DOUBLE, c3 TEXT, c4 INTEGER); INSERT INTO t0(c0, c1, c2, c3, c4) VALUES (1, 1.1, -0.5, 'alpha', 10), (2, -2.2, 0.2, 'beta', 20), (3, 3.3, -1.5, 'gamma', 30), (4, -4.4, 0.4, 'delta', 10), (5, 5.5, -2.5, 'epsilon', 20); SELECT c0, c1, c2, c3, c4, PERCENT_RANK() OVER (PARTITION BY c3 ORDER BY ABS(c1 * c2) + CASE WHEN c4 > 15 THEN c4 ELSE c4 / 2 END DESC) AS rank_percent FROM t0;