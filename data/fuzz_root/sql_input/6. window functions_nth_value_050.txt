CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(5), c3 FLOAT); INSERT INTO t0 (c0, c1, c2, c3) VALUES (100, -0.99, 'alpha', 5.5), (200, 1.23, 'beta', -10.1), (300, -2.34, 'alpha', 20.2), (400, 3.45, 'gamma', -30.3), (500, -4.56, 'beta', 40.4); SELECT nth_value(c3 / c1, 2) OVER (PARTITION BY c2 ORDER BY c0 DESC ROWS BETWEEN CURRENT ROW AND 1 FOLLOWING) * nth_value(c1, 1) OVER (PARTITION BY c2 ORDER BY c0 ASC) AS metric_difference FROM t0;