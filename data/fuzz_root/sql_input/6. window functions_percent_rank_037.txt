CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 TEXT, c3 FLOAT, c4 DOUBLE); INSERT INTO t0(c0, c1, c2, c3, c4) VALUES (1, 1.1, 'x', 0.1, 10.1), (2, -2.2, 'y', -0.2, -20.2), (3, 3.3, 'z', 0.3, 30.3), (4, -4.4, 'x', -0.4, -40.4), (5, 5.5, 'y', 0.5, 50.5); SELECT c0, c1, c2, c3, c4, PERCENT_RANK() OVER (PARTITION BY c2 ORDER BY c1 / NULLIF(c4, 0) + c3 * c4 ASC) AS rank_percent FROM t0;