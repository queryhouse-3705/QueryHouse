CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(10), c3 DOUBLE); INSERT INTO t0 (c0, c1, c2, c3) VALUES (100, 12.34, 'grpX', 1.1), (200, -23.45, 'grpY', -2.2), (300, 34.56, 'grpX', 3.3), (400, -45.67, 'grpZ', -4.4), (500, 56.78, 'grpY', 5.5); SELECT nth_value(c3 / c1, 2) OVER (PARTITION BY c2 ORDER BY c0 ROWS UNBOUNDED PRECEDING) * nth_value(c1, 1) OVER (PARTITION BY c2 ORDER BY c0 DESC) AS adjusted_ratio FROM t0 WHERE c1 <> 0.0;