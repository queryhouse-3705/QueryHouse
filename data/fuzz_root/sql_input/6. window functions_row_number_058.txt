CREATE TABLE t0 (c0 DOUBLE, c1 TEXT, c2 INTEGER); INSERT INTO t0 (c0, c1, c2) VALUES (0.01, 'alpha', 10), (0.02, 'beta', 20), (0.03, 'alpha', 30), (0.04, 'gamma', 40); SELECT c0, c1, c2, ROW_NUMBER() OVER (PARTITION BY c1 ORDER BY c2 ASC, c0 DESC) AS rn FROM t0;