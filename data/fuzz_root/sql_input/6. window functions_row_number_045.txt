CREATE TABLE t0 (c0 TEXT, c1 FLOAT, c2 FLOAT); INSERT INTO t0 (c0, c1, c2) VALUES ('v0', 1.1, 10.0), ('v1', 2.2, 20.0), ('v2', 3.3, 10.0), ('v3', 4.4, 30.0); SELECT c0, c1, c2, ROW_NUMBER() OVER (PARTITION BY c2 ORDER BY c1 DESC, LENGTH(c0)) AS rn FROM t0;