CREATE TABLE t0 (c0 INTEGER, c1 FLOAT, c2 VARCHAR(5), c3 VARCHAR(5)); INSERT INTO t0 (c0, c1, c2, c3) VALUES (10, 5.0, 'alpha', 'X'), (20, 10.0, 'beta', 'Y'), (30, 15.0, 'alpha', 'X'), (40, 20.0, 'gamma', 'Z'), (50, 25.0, 'beta', 'Y'); SELECT nth_value(c1, 2) OVER (PARTITION BY c2, c3 ORDER BY c0 ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) - nth_value(c1, 1) OVER (PARTITION BY c3 ORDER BY c0 DESC) AS difference FROM t0;