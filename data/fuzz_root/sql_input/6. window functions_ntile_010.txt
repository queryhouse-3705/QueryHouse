CREATE TABLE t0(c0 INTEGER, c1 FLOAT, c2 VARCHAR(10)); INSERT INTO t0 VALUES (10, 1.01, 'v0'), (10, 1.02, 'v1'), (20, 2.01, 'v2'), (30, 3.01, 'v3'), (NULL, 0.01, 'v4'); SELECT c0, c1, NTILE(2) OVER (PARTITION BY c2 ORDER BY COALESCE(c0, 0)) AS ntile_rank FROM t0;